container AllocExports: Using = "Units", isHidden = "True"
{
	container PlanRegioResults
	{
		Unit<UInt32>  table := PlanRegio
		{
			attribute<string> BU_CODE                                 := Model/Geography/RegioIndelingen/buurt/BU_CODE;
			attribute<Classifications/AanbodOptie> AanbodOptie        := EndState/AanbodOpties/PlanRegioWarmteAllocatie;

			attribute<kg_yr> CO2_gebouwen_AardGas_totaal              := indicatoren/CO2/gebouwen/AardGas/totaal;
			attribute<kg_yr> CO2_gebouwen_Elektriciteit_totaal        := indicatoren/CO2/gebouwen/Elektriciteit/totaal;
			attribute<kg_yr> CO2_gebouwen_totaal                      := indicatoren/CO2/gebouwen/totaal;
			attribute<kg_yr> CO2_totaal                               := indicatoren/CO2/totaal;
			attribute<Eur_yr> netverzwaring                           := indicatoren/netwerk/Elektriciteit/netverzwaring;

			attribute<kW> Woning_CapaciteitWarmteD                    := Initieel/KostenBaten/PlanRegioKaarten/Woning/CapaciteitWarmteD;
			attribute<nrAansl>Woning_nrAanslWarmteD                   := Initieel/KostenBaten/PlanRegioKaarten/Woning/nrAanslWarmteD;
			attribute<Float64>Woning_nrModelUnitsWarmteD              := Initieel/KostenBaten/PlanRegioKaarten/Woning/nrModelUnitsWarmteD;
			attribute<GJ_yr> Woning_VerbruikA                         := Initieel/KostenBaten/PlanRegioKaarten/Woning/VerbruikA;
			attribute<Eur_yr>Woning_WarmteVraagA                      := Initieel/KostenBaten/PlanRegioKaarten/Woning/WarmteVraagA;
			attribute<GJ_yr> Vj_WarmtePrimairD                        := Initieel/KostenBaten/Vj_WarmtePrimairD;
			attribute<GJ_yr> WarmteVraagD                             := Initieel/KostenBaten/WarmteVraagD;

			attribute<Percent> Eigendom_Koopwoningen                  := Model/Geography/RegioIndelingen/buurt/Eigendom/p_koopw;
			attribute<Percent> Eigendom_Huurwoningen_totaal           := Model/Geography/RegioIndelingen/buurt/Eigendom/p_huurw;
			attribute<Percent> Eigendom_In_bezit_woningcorporatie     := Model/Geography/RegioIndelingen/buurt/Eigendom/p_wcorpw;
			attribute<Percent> Eigendom_In_bezit_overige_verhuurders  := Model/Geography/RegioIndelingen/buurt/Eigendom/p_ov_hw;
			attribute<Percent> Eigendom_Eigendom_onbekend             := Model/Geography/RegioIndelingen/buurt/Eigendom/p_e_o_w;
			attribute<Percent> Eigendom_p_checksum                    := Model/Geography/RegioIndelingen/buurt/Eigendom/p_checksum;//eigen check
			attribute<Percent> Inkomen_Huishoudens_met_laag_inkomen   := Model/Geography/RegioIndelingen/buurt/Inkomen/p_hh_li;
			attribute<Percent> Inkomen_Huishoudens_met_hoog_inkomen   := Model/Geography/RegioIndelingen/buurt/Inkomen/p_hh_hi;
			attribute<Percent> Inkomen_Huishoudens_met_midden_inkomen := Model/Geography/RegioIndelingen/buurt/Inkomen/p_hh_mi;//berekend veld uit andere velden
			attribute<Percent> Inkomen_p_checksum                     := Model/Geography/RegioIndelingen/buurt/Inkomen/p_checksum;//eigen check

			attribute<GJ_yr> GebiedsOptie_totaal                      := RunContext/J2010/indicatoren/Metervraag/gebouwen/GebiedsOptie/totaal;
			attribute<GJ_yr> Aardgas_totaal                           := RunContext/J2010/indicatoren/Metervraag/gebouwen/Aardgas/totaal;
			attribute<GJ_yr> Elektriciteit_totaal                     := RunContext/J2010/indicatoren/Metervraag/gebouwen/Elektriciteit/totaal;
		}

		container export := Rapportage/ExportCsvT(table, SubItem_PropValues(table,'name'), OutputFolder+'/PR.csv');
	}

	template BebouwingsComponentTempl
	{
		parameter<String> ComponentName;
		container AllocatieResultaatComponent;
		
		container VestaRunDataComponent     := AllocatieResultaatComponent/VestaRunDataComponent;
		container RuimtelijkeVraagComponent := AllocatieResultaatComponent/RuimtelijkeVraagComponent;

		Unit<UInt32>  table := AllocatieResultaatComponent/BebouwingsObject
		{
			//attribute<String> BAG_id := /Model/BronData/BAG/vbo_woonfunctie/identificatie;
			attribute<string>  id              := code;
			attribute<string>  Label           := VestaRunDataComponent/bebouwing/label;
			attribute<nrAansl> nrAansluitingen := RuimtelijkeVraagComponent/nrAansluitingen;

			attribute<Classifications/AanbodOptie> AanbodOptie : = AllocatieResultaatComponent/WarmteAllocatie;

			attribute<GJ_yr> MV_RW                        := AllocatieResultaatComponent/MeterVraag/RestWarmte;
			attribute<GJ_yr> MV_GT                        := AllocatieResultaatComponent/MeterVraag/GeoThermie;
			attribute<GJ_yr> MV_WKO                       := AllocatieResultaatComponent/MeterVraag/WKO;
			attribute<GJ_yr> MV_WKK                       := AllocatieResultaatComponent/MeterVraag/WijkWKK;
			attribute<GJ_yr> MV_BIOWKK                    := AllocatieResultaatComponent/MeterVraag/BioWKK;
			attribute<GJ_yr> MV_GAS                       := AllocatieResultaatComponent/MeterVraag/AardGas;
			attribute<GJ_yr> MV_ELEK                      := AllocatieResultaatComponent/MeterVraag/Elektriciteit;
			attribute<GJ_yr> MV_TOTL                      := AllocatieResultaatComponent/MeterVraag/Totaal;

			attribute<KG_yr> CO2_GAS                      := AllocatieResultaatComponent/CO2/AardGas;
			attribute<KG_yr> CO2_ELEK                     := AllocatieResultaatComponent/CO2/Elektriciteit;

			attribute<Eur> AansluitBijdrage_Gas           := AllocatieResultaatComponent/AardGas/AansluitBijdrage;
			attribute<Eur> AansluitBijdrage_Elek          := AllocatieResultaatComponent/Elektriciteit/AansluitBijdrage;
			attribute<Eur_yr> CO2Heffing_Gas              := AllocatieResultaatComponent/AardGas/CO2Heffing;
			attribute<Eur_yr> CO2Heffing_Elek             := AllocatieResultaatComponent/Elektriciteit/CO2Heffing;
			attribute<Eur_yr> Eindgebruik_ex_Gas          := AllocatieResultaatComponent/AardGas/eindgebruik_ex;
			attribute<Eur_yr> Eindgebruik_ex_Elek         := AllocatieResultaatComponent/Elektriciteit/eindgebruik_ex;
			attribute<Eur_yr> EnergieHeffing_Gas          := AllocatieResultaatComponent/AardGas/EnergieHeffing;
			attribute<Eur_yr> EnergieHeffing_Elek         := AllocatieResultaatComponent/Elektriciteit/EnergieHeffing;
			attribute<uint8> ggk_rel_Gas                  := AllocatieResultaatComponent/AardGas/ggk_rel;
			attribute<uint8> ggk_rel_Elek                 := AllocatieResultaatComponent/Elektriciteit/ggk_rel;

			attribute<Eur_yr> Maatschappelijk_Gas         := AllocatieResultaatComponent/AardGas/maatschappelijk;
			attribute<Eur_yr> Maatschappelijk_Elek        := AllocatieResultaatComponent/Elektriciteit/maatschappelijk;
			attribute<Eur_yr> Netwerk_Gas                 := AllocatieResultaatComponent/AardGas/netwerk;
			attribute<Eur_yr> Netwerk_Elek                := AllocatieResultaatComponent/Elektriciteit/netwerk;

			attribute<classifications/EnergieLabel> EL_LV := VestaRunDataComponent/energielabel/LastValue;
			attribute<classifications/EnergieLabel> EL_CV := VestaRunDataComponent/energielabel/CurrValue;
			attribute<bool> EL_WC                         := VestaRunDataComponent/energielabel/WasChanged;
			attribute<bool> EL_ICN                        := VestaRunDataComponent/energielabel/IsChangedNow;
			attribute<bool> EL_IC                         := VestaRunDataComponent/energielabel/IsChanged;

			attribute<m2> ZonneBoiler_m2                  := VestaRunDataComponent/Hoeveelheden/ZonneBoiler;
			attribute<m2> Zon_PV_m2                       := VestaRunDataComponent/Hoeveelheden/Zon_PV;
			attribute<nrAansl> mWKK_aantal                := VestaRunDataComponent/Hoeveelheden/mWKK;
			attribute<nrAansl> hWP_aantal                 := VestaRunDataComponent/Hoeveelheden/hWP;

			attribute<Eur> Ki_Totaal                      := VestaRunDataComponent/Kosten/Ki_Totaal;
			attribute<Eur> Ki_ZonneBoiler                 := VestaRunDataComponent/Kosten/Ki_ZonneBoiler;
			attribute<Eur> Ki_Zon_PV                      := VestaRunDataComponent/Kosten/Ki_Zon_PV;
			attribute<Eur> Ki_mWKK                        := VestaRunDataComponent/Kosten/Ki_mWKK;
			attribute<Eur> Ki_hWP                         := VestaRunDataComponent/Kosten/Ki_hWP;
			attribute<Eur> Ki_eWP                         := VestaRunDataComponent/Kosten/Ki_eWP;
			attribute<Eur> Ki_EWV                         := VestaRunDataComponent/Kosten/Ki_EWV;
			attribute<Eur_yr> Kj_gv_incentive             := VestaRunDataComponent/Kosten/Kj_gv_incentive;
		}
		container export := Rapportage/ExportCsvT(table, SubItem_PropValues(table,'name'), OutputFolder+'/'+ComponentName+'.csv');
	}

	container BebouwingsComponentResults :=
		for_each_ne(Classifications/BebouwingsComponent/name,
			'BebouwingsComponentTempl('+Quote(Classifications/BebouwingsComponent/name)+',AllocatieResultaat/'+Classifications/BebouwingsComponent/name+')');

	parameter<String> GenerateAll := 'Ready', ExplicitSuppliers = 
		"='PlanRegioResults/export/result;'"
		"+AsList('BebouwingsComponentResults/'+Classifications/BebouwingsComponent/name+'/export/result',';')";
}